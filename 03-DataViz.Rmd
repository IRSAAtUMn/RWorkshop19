# Understanding data: Visualization

*Author: Alicia Johnson*

<!-- add chapter 0 on getting set up / make sure packages are installed? -->
<!-- has filter been defined?  is dplyr installed? -->
<!-- swap subset for filter?! -->


\
\


## Goal: Understanding Through Visualizations


In this module we'll focus on the __"Visualise"__ step in the data science workflow:

\
\


<center>
<div class="image">
<img src="images/data-science.png" style="width: 475px"/>
<div>source: [Wickham & Grolemund: R for Data Science](http://r4ds.had.co.nz/) </div>
</div>
</center>



\
\



Reconsider and __import__ the `US_births_2000_2014` data in the `fivethirtyeight package`:

```{r}
library(fivethirtyeight)
data("US_births_2000_2014")

# Give the data a shorter nickname
birth_data <- US_births_2000_2014
```

```{r echo=FALSE}
DT::datatable(birth_data, options = list(pageLength = 5))
library(gridExtra)
```

\
\
\
\


We investigated the basic structure of this __tidy__ data set in the previous activity.  Now we can start to ask some __research questions__ to better __understand__ the data:    

- What's the _typical_ number of births per day?    
- To what degree do the number of births _vary_ from day to day?    
- Is there a _relationship_ between the number of births and time of year?  Between the number of births and day of week?    
- Is there any evidence that people are too superstitious to give birth on Friday the 13th?    


\
\


__Visualizing__ the data is the first natural step in answering these questions.  Why?

- Visualizations help us understand what we're working with: What are the scales of our variables?  Are there any outliers, i.e. unusual cases?  What are the patterns among our variables?    
- This understanding will inform our next steps: What statistical tool / model is appropriate?    
- Once our analysis is complete, visualizations are a powerful way to communicate our findings and tell a story.



\
\
\
\



## ggplot

We'll construct visualizations using the `ggplot` function in RStudio.  Though the `ggplot` learning curve can be steep, its "grammar" is intuitive and generalizable once mastered.  The `ggplot` plotting function is stored in the `ggplot2` package: 

\ 
\ 


```{r eval=FALSE}
library(ggplot2)
```

```{r echo=FALSE}
suppressPackageStartupMessages(library(ggplot2))
```


The best way to learn about `ggplot` is to just play around.  Don't worry about memorizing the syntax.  Rather, focus on the *patterns* and *potential* of their application.  There's a helpful cheat sheet for future reference:

<center>
[**GGPLOT CHEAT SHEET**](https://www.rstudio.com/wp-content/uploads/2015/03/ggplot2-cheatsheet.pdf)
</center>


\
\
\
\



\
\
\
\


## Univariate visualizations


Our primary variable of interest in the birthday data is the __quantitative__ `births` variable which summarizes the number of U.S. births on each individual day between 2000 and 2014.  Before examining the relationship between `births` and any other variable, it's important to develop an understanding of the **univariate** patterns.  Weâ€™ll explore 2 of many methods for visualizing quantitative variables: histograms & density plots.    


\
\


### Histograms

A **histogram** is constructed by (1) dividing up the observed range of the variable into 'bins' of equal width; and (2) counting up the number of cases that fall into each bin.  Try out the code below. 

```{r echo = FALSE}
only_2014 <- subset(birth_data, year == 2014)
```


\


1. __Construct a histogram for the 2014 `births`__    
    Try out the code below that builds up from a simple to a customized histogram. At each step determine how each piece of code contributes to the plot.        
    ```{r eval=FALSE}
    # Focus first on just the 2014 data
    library(dplyr)
    only_2014 <- birth_data %>% 
      filter(year == 2014)
    
    # Set up a plotting frame
    ggplot(only_2014, aes(x = births))
    
    # Add a histogram layer
    ggplot(only_2014, aes(x = births)) +
      geom_histogram()
    
    # Change the border colors
    ggplot(only_2014, aes(x = births)) +
      geom_histogram(color = "white") 
    ```
    
  
\
\


2. __Examine the histogram__    
    Based on the histogram alone...    
    - Examine the _trend_: roughly, what's the _typical_ number of births per day?    
    - Examine the _variability_: roughly, what was the smallest number of births?  The largest?  
    - Describe the _shape_ of the histogram?  Do you have any guesses about what explains this shape?    
    - How wide are the `births` bins?    
    - What was the most common bin?  On roughly how many days did the number of births fall into this bin?    
    


\
\


3. __Tune the histogram__    
    The bin size used above was the default selected by RStudio.  Below, change the bin width and reflect upon how this impacts the visualization.  Specifically, explain why selecting bin width is a _Goldilocks problem_ -- we don't want the bins to be too narrow or too wide, but just right.       
    
    ```{r eval = FALSE} 
    # Decrease bin width
    ggplot(only_2014, aes(x = births)) +
      geom_histogram(color = "white", binwidth = 30)
    
    # Increase bin width
    ggplot(only_2014, aes(x = births)) +
      geom_histogram(color = "white", binwidth = 2500)
    ```


\
\



4. __You try__    
    Construct a histogram of `births` using the entire `birth_data` which spans from 2000 to 2014. How, if at all, do the trends and variability in `births` across all of these years compare to those in 2014 alone?

    
    
    


\
\
\
\
\


In summary, you constructed: 

```{r echo=FALSE,fig.width=8, fig.height=7}
g0 = ggplot(only_2014, aes(x=births))
g1 = g0 + geom_histogram()
g3 = ggplot(only_2014, aes(x=births)) +
    geom_histogram(color="white") 
g4 = ggplot(only_2014, aes(x=births)) +
    geom_histogram(color="white", binwidth=30)
g5 = ggplot(only_2014, aes(x=births)) +
    geom_histogram(color="white", binwidth=2500)
grid.arrange(g0,g1,g3,g4,g5,ncol=3)
```



\
\
\
\
\
\
\




### Density plots


A **density plot** is essentially a smooth version of the histogram.  Instead of sorting cases into discrete bins, the "density" of cases is calculated across the entire range of values.  The greater the number of cases, the greater the density!  The density is then scaled so that the area under the density curve **always equals 1** and the area under any fraction of the curve represents the fraction of cases that lie in that range.    


\
\


5. __Construct a density plot for the 2014 `births`__    
    ```{r eval=FALSE}
    # Set up the plotting frame
    ggplot(only_2014, aes(x = births))
    
    # Add a density curve
    ggplot(only_2014, aes(x = births)) +
        geom_density()
    ```


\
\



6. __Examine the density plot for the 2014 `births`__    
    - Does this visualization provide any information that the histogram doesn't?    
    - Which do you prefer for visualizing the `births` data, the density plot or histogram?  Why?    
    
    

\
\
\
\


In summary, you constructed: 

```{r echo=FALSE, fig.width=6, fig.height = 2.5, warning=FALSE}
g1 = ggplot(only_2014, aes(x=births))
g2 = g1 + geom_density()
grid.arrange(g1,g2,ncol=2)
```





\  
\
\
\
\
\
\
\





## Visualizing relationships

Consider the data on just the first 6 days of 2014:

```{r echo=FALSE}
DT::datatable(head(only_2014), options = list(pageLength = 6))
```



\
\



We saw some goofy patterns in the `births` data.  Perhaps this might be explained by day of year, month, or day of week.  However, before constructing graphics of the relationships among these variables, we need to understand what features these graphics should have.  Challenge yourself to think about how we might visualize the relationships among the following sets of variables:

- `births` vs `date`

- `births` vs `day_of_week`

- `births` vs `date` *and* `day_of_week` (in 1 plot)



\
\
\
\



### Quantitative vs quantitative




7. **Scatterplots of 2 quantitative variables**    
    Let's start by visualizing the relationship between the number of daily `births` and the date or day of year for the 2014 births data.  We can think of both as _quantitative variables_.  In order to visualize their numerical scales, both variables need an axis.  On these axes, we can represent each row (day) by a dot.   
    
    
    ```{r eval=FALSE}
    # Just a graphics frame
    ggplot(only_2014, aes(y = births, x = date))
    
    # Add a scatterplot layer
    ggplot(only_2014, aes(y = births, x = date)) +
      geom_point()
    ```
    

\
\



8. __You try__    
    Construct a scatterplot of `births` vs `date` using the 2000-2014 `birth_data`.    
    

\
\



9. __Examine the scatterplots__
    - Do you observe any _s(easonal_ trends?  If so, at what time of year do `births` tend to be the highest?  The lowest?    
    - Any other strange patterns?  What do you think might explain these patterns?    


\
\



10. __Visualize the trend__    
    Finally, we can add a visual summary of the trend in `births` by date.  Explain why this isn't very helpful in this particular example.    
    
    ```{r eval=FALSE}
    # Add a smooth trend line
    ggplot(only_2014, aes(y = births, x = date)) +
      geom_point() + 
      geom_smooth()
    ```



\
\
\
\



In summary: 

```{r echo=FALSE, fig.width=4, fig.height=8, warning=FALSE}
g1=ggplot(only_2014, aes(y=births, x=date))
g2=ggplot(only_2014, aes(y=births, x=date)) +
    geom_point()
g3=ggplot(birth_data, aes(y=births, x=date)) +
    geom_point()
g4=ggplot(only_2014, aes(y=births, x=date)) +
    geom_point() + 
    geom_smooth()

grid.arrange(g1,g2,g3,g4, ncol=1)
```



\
\
\
\




### Quantitative vs categorical

Next, consider the relationship between `births` (quantitative) and `day_of_week` (categorical).  Since `day_of_week` is categorical, visualizing this variable requires a _visual grouping_ mechanism.  We'll consider a couple approaches.    


\
\


11. __Construct side-by-side plots__    
    Again focus on the general patterns in the syntax and how we've changed the earlier code.    
    ```{r eval=FALSE}
    # Density plots by group
    ggplot(only_2014, aes(x = births, fill = day_of_week)) +
      geom_density()
    
    # To see better: add transparency
    ggplot(only_2014, aes(x = births, fill = day_of_week)) +
      geom_density(alpha = 0.5)
    
    # Or use boxplots!
    ggplot(only_2014, aes(x = day_of_week, y = births)) + 
      geom_boxplot()
    
    ```
    

\
\


12. __Interpreting the side-by-side plots__    
    - What do the side-by-side plots reveal about birth patterns?    
    - Which day tends to see the fewest births?  The greatest?    
    - There are some outliers here.  What do you suspect explains these outliers?
    
    
\
\
\
\

In summary: 

```{r echo=FALSE, fig.width=8, fig.height = 2.5, warning=FALSE}
g1=ggplot(only_2014, aes(x=births, fill=day_of_week)) +
    geom_density()
g2=ggplot(only_2014, aes(x=births, fill=day_of_week)) +
    geom_density(alpha=0.5)
g3 <- ggplot(only_2014, aes(x = day_of_week, y = births)) + 
  geom_boxplot()
grid.arrange(g1,g2,g3,ncol=3)
```

\
\
\
\



### Quantitative vs quantitative vs categorical    


13. __Three variables__    
    If `day_of_week` and `date` both explain some of the variability in `births`, why not include both in our analysis?!  Let's.  Note how the code changes.

    ```{r eval = FALSE}
    # births vs date
    ggplot(only_2014, aes(y = births, x = date)) +
      geom_point() 
    
    # births vs day_of_week
    ggplot(only_2014, aes(x = births, fill = day_of_week)) +
      geom_density(alpha=0.5)
    
    # births vs date AND day_of_week
    ggplot(only_2014, aes(y = births, x = date, color = day_of_week)) +
      geom_point() 
    ```


\
\


14. __Visualize the trend__    
    Finally, let's visualize the birth trends from 2000-2014.    
    ```{r eval = FALSE}
    # add trend lines
    ggplot(birth_data, aes(y = births, x = date, color = day_of_week)) +
      geom_point() +
      geom_smooth()
    
    # change the smoothness 
    ggplot(birth_data, aes(y = births, x = date, color = day_of_week)) +
      geom_point() +
      geom_smooth(span = 0.1)
    ```
    



\
\



14. __Summarize__    
    Summarize what you've learned about birth patterns.    
    - In what month do the most babies tend to be born?  The least?    
    - On what day of week do the most babies tend to be born?  The least?    
    - In what year were the most babies born?  The least?    
    - What explains the outliers in the dataset?


\
\
\
\
\
\
\
\





## Exercises

In the exercises, you'll return to the Bechdel test data:

```{r}
library(fivethirtyeight)
data(bechdel)
dim(bechdel)
```

**Solutions are provided below.**

\
\


### Questions

1. __Visualizing a categorical variable__    
    The categorical `binary` variable records whether each film in the dataset passes or fails the Bechdel test:    
    ```{r collapse=TRUE, eval = FALSE}
    levels(factor(bechdel$binary))
    ```
    
    A bar chart provides a simple visualization of this variable.  Summarize what you learn from this plot: roughly how many of the films pass / fail the test?
    
    ```{r eval=FALSE}
    # Bar plot
    ggplot(bechdel, aes(x = binary)) + 
      geom_bar()
    ```



\
\


2. __Visualize potential "predictors"__    
    Our ultimate goal will be to better understand which films pass / fail the Bechdel test.  For example, can this be explained the year in which it was made?  The film's budget?  The amount of money it makes at the box office?  Before we can answer these questions, it's important to understand the scales of these variables.  For each variable below, construct and summarize a __univariate visualization__.    
    a. `year`: the year in which the film was released    
    b. `budget_2013`: the film's budget (in 2013 \$)    
    c. `domgross_2013`: the film's total domestic gross (in 2013 \$)
    

\
\


3. __binary vs x__    
    To answer each question below, construct and summarize a visualization between the given pair of variables.  The hints below apply in each scenario.    
    a. Is there a relationship between the `year` in which a film is made and whether is passes the Bechdel (`binary`)?    
    b. Do movies that pass the Bechdel test tend to receive more or less funding (as measured by `budget_2013`) than those that fail the test?    
    c. Do movies that pass the Bechdel test tend to make more or less money (as measured by `domgross_2013`) than those that fail the test?    
    
    \
    
    __Hints__    
    
    - Is `binary` categorical or quantitative?  What about the other variable?  Thus what visualization tool might you use?    
    - Fill in the following: 
        
        ```{r eval = FALSE}
        ggplot(___, aes(x = ___, y = ___)) + 
          ___()
        ```
    

\
\




4. __binary vs x1 and x2__    
    For each question below, construct and summarize a helpful visualization that includes a `geom_smooth()`.   
    a. How have the budgets (`budget_2013`) of films that pass / fail the Bechdel test (`binary`) changed and compared over time (`year`)?  HINT: Put `year` on the x-axis.    
    b. How have the gross profits (`domgross_2013`) of films that pass / fail the Bechdel test (`binary`) changed and compared over time (`year`)?  HINT: Put `year` on the x-axis.
    c. How does the "return on investment" compare for films that pass / fail the Bechdel test?  Specifically, examine the relationship between `domgross_2013` and `budget_2013` for films that pass / fail the Bechdel test (`binary`).  HINT: Put `budget_2013` on the x-axis.
    


\
\


5. __Extra: identify the outliers__    
    By now, you've seen some outliers in your visualizations.  Try to identify these by subsetting the `bechdel` data.    
    
    
\
\


6. __Extra visualization practice__    
    Bike sharing is becoming a more popular means of transportation in many cities. The dataset we will analyze in this assignment comes from Capital Bikeshare, the bike-sharing service for the Washington DC area. The dataset originally comes from the [UCI Machine Learning Repository](https://archive.ics.uci.edu/ml/datasets/Bike+Sharing+Dataset) and the version weâ€™ll work with is made available at Macalester Prof Shumanâ€™s website:    
    
    ```{r}
    bikes <- read.csv("https://www.macalester.edu/~dshuman1/data/155/bike_share.csv")
    ```
    
    **Codebook**

    variable              meaning
    --------------------- ----------------------------------------------------
    `date`                date in format YYYY-MM-DD
    `season`              winter, spring, summer, or fall
    `year`                2011 or 2012
    `month`               3-letter month abbreviation
    `day_of_week`         3-letter abbreviation for day of week
    `weekend`             TRUE if the case is a weekend, FALSE otherwise
    `holiday`             is the day a holiday? (yes or no)
    `temp_actual`         temperature in degrees Fahrenheit
    `temp_feel`           what the temperature *feels* like in degrees Fahrenheit
    `humidity`            fraction from 0 to 1 giving the humidity level
    `windspeed`           wind speed in miles per hour
    `weather_cat`         `categ1`: clear to partly cloudy <br> `categ2`: mist + some clouds <br> `categ3`: light precipitation to thunderstorms
    `riders_casual`       count of daily rides by casual users (non-registered users)
    `riders_registered`   count of daily rides by registered users
    `riders_total`        count of total daily rides (`riders_casual + riders_registered`)
    
    
    \
    \
    
    Utilize visualizations to better understand how `riders_registered` might depend upon `windspeed`, `temp_feel`, `weekend`, or `season`.
    
    

    

    

    
    


\
\
\
\
\
\




\
\
\


### Solutions

1. More films fail than pass the Bechdel test (~1000 vs ~800).    
    ```{r fig.width = 3.5, fig.height = 2}
    ggplot(bechdel, aes(x = binary)) + 
      geom_bar()
    ```    


2. .   
    ```{r eval = FALSE}
    # a
    ggplot(bechdel, aes(x = year)) + 
      geom_histogram(color = "white")
    ggplot(bechdel, aes(x = year)) + 
      geom_density()
    
    # b
    ggplot(bechdel, aes(x = budget_2013)) + 
      geom_histogram(color = "white")
    ggplot(bechdel, aes(x = budget_2013)) + 
      geom_density()
    
    # c
    ggplot(bechdel, aes(x = domgross_2013)) + 
      geom_histogram(color = "white")
    ggplot(bechdel, aes(x = domgross_2013)) + 
      geom_density()
    ```
    
    ```{r echo = FALSE, fig.width = 5, fig.height = 6}
    # a
    g1 <- ggplot(bechdel, aes(x = year)) + 
      geom_histogram(color = "white")
    g2 <- ggplot(bechdel, aes(x = year)) + 
      geom_density()
    
    # b
    g3 <- ggplot(bechdel, aes(x = budget_2013)) + 
      geom_histogram(color = "white")
    g4 <- ggplot(bechdel, aes(x = budget_2013)) + 
      geom_density()
    
    # c
    g5 <- ggplot(bechdel, aes(x = domgross_2013)) + 
      geom_histogram(color = "white")
    g6 <- ggplot(bechdel, aes(x = domgross_2013)) + 
      geom_density()
    
    grid.arrange(g1,g2,g3,g4,g5,g6,ncol=2)
    ```    
    


3. Over time, more films have been passing the Bechdel test.  Further, films that fail the Bechdel tend to have bigger budgets and to make more money.

    ```{r eval = FALSE}
    # a
    ggplot(bechdel, aes(x = year, fill = binary)) + 
      geom_density(alpha = 0.5)
    ggplot(bechdel, aes(x = binary, y = year)) + 
      geom_boxplot()
    
    # b
    ggplot(bechdel, aes(x = budget_2013, fill = binary)) + 
      geom_density(alpha = 0.5)
    ggplot(bechdel, aes(x = binary, y = budget_2013)) + 
      geom_boxplot()
    
    # c
    ggplot(bechdel, aes(x = domgross_2013, fill = binary)) + 
      geom_density(alpha = 0.5)
    ggplot(bechdel, aes(x = binary, y = domgross_2013)) + 
      geom_boxplot()
    ```
    
    ```{r echo = FALSE, fig.width = 6, fig.height = 6}
    # a
    g1 <- ggplot(bechdel, aes(x = year, fill = binary)) + 
      geom_density(alpha = 0.5)
    g2 <- ggplot(bechdel, aes(x = binary, y = year)) + 
      geom_boxplot()
    
    # b
    g3 <- ggplot(bechdel, aes(x = budget_2013, fill = binary)) + 
      geom_density(alpha = 0.5)
    g4 <- ggplot(bechdel, aes(x = binary, y = budget_2013)) + 
      geom_boxplot()
    
    # c
    g5 <- ggplot(bechdel, aes(x = domgross_2013, fill = binary)) + 
      geom_density(alpha = 0.5)
    g6 <- ggplot(bechdel, aes(x = binary, y = domgross_2013)) + 
      geom_boxplot()
    
    grid.arrange(g1,g2,g3,g4,g5,g6,ncol=2)
    ```   
    
    
4. .
    
    
    ```{r eval = FALSE}
    # a
    ggplot(bechdel, aes(x = year, y = budget_2013, color = binary)) + 
      geom_point() + 
      geom_smooth()
    
    # b
    ggplot(bechdel, aes(x = year, y = domgross_2013, color = binary)) + 
      geom_point() + 
      geom_smooth()
    
    # c
    ggplot(bechdel, aes(x = budget_2013, y = domgross_2013, color = binary)) + 
      geom_point() + 
      geom_smooth()
    ```
    
    ```{r echo = FALSE, fig.width = 8, fig.height = 2.5}
    # a
    g1 <- ggplot(bechdel, aes(x = year, y = budget_2013, color = binary)) + 
      geom_point() + 
      geom_smooth()
    
    # b
    g2 <- ggplot(bechdel, aes(x = year, y = domgross_2013, color = binary)) + 
      geom_point() + 
      geom_smooth()
    
    # c
    g3 <- ggplot(bechdel, aes(x = budget_2013, y = domgross_2013, color = binary)) + 
      geom_point() + 
      geom_smooth()
    
    grid.arrange(g1,g2,g3,ncol=3)
    ```   


5. For example, we can i.d. the film that made the most money:    
    ```{r}
    library(dplyr)
    bechdel %>% 
      filter(domgross_2013 > 1500000000)
    ```
    

6. Choose your own adventure!  Here are some ideas:

    ```{r eval = FALSE}
    # rides vs windspeed
    ggplot(bikes, aes(y = riders_registered, x = windspeed)) + 
        geom_point() + 
        geom_smooth()
    
    # rides vs temperature
    ggplot(bikes, aes(y = riders_registered, x = temp_feel)) + 
        geom_point() + 
        geom_smooth()

    # rides by weekend
    ggplot(bikes, aes(y = riders_registered, x = weekend)) + 
        geom_boxplot()    
    
    # rides by season
    ggplot(bikes, aes(y = riders_registered, x = season)) + 
        geom_boxplot() 
    
    # rides by windspeed and weekend
    ggplot(bikes, aes(y = riders_registered, x = windspeed, color = weekend)) + 
        geom_point() + 
        geom_smooth()
        
    # EXTRA: rides by season and weekend
    ggplot(bikes, aes(y = riders_registered, x = season, fill = weekend)) + 
        geom_boxplot()
    
    # EXTRA: rides by windspeed and temperature
    ggplot(bikes, aes(y = riders_registered, x = windspeed, color = temp_feel)) + 
        geom_point()
    ggplot(bikes, aes(y = riders_registered, x = windspeed, size = temp_feel)) + 
        geom_point()
    ```


    ```{r echo = FALSE, fig.width = 8, fig.height = 5}
    g1 <- ggplot(bikes, aes(y = riders_registered, x = windspeed)) + 
        geom_point() + 
        geom_smooth()
    g2 <- ggplot(bikes, aes(y = riders_registered, x = temp_feel)) + 
        geom_point() + 
        geom_smooth()
    g3 <- ggplot(bikes, aes(y = riders_registered, x = weekend)) + 
        geom_boxplot()    
    g4 <- ggplot(bikes, aes(y = riders_registered, x = season)) + 
        geom_boxplot() 
    grid.arrange(g1,g2,g3,g4,ncol=2)
    ```
    

    ```{r echo = FALSE, fig.width = 8, fig.height = 5}
    # rides by windspeed and weekend
    g1 <- ggplot(bikes, aes(y = riders_registered, x = windspeed, color = weekend)) + 
        geom_point() + 
        geom_smooth()
        
    # EXTRA: rides by season and weekend
    g2 <- ggplot(bikes, aes(y = riders_registered, x = season, fill = weekend)) + 
        geom_boxplot()
    
    # EXTRA: rides by windspeed and temperature
    g3 <- ggplot(bikes, aes(y = riders_registered, x = windspeed, color = temp_feel)) + 
        geom_point()
    g4 <- ggplot(bikes, aes(y = riders_registered, x = windspeed, size = temp_feel)) + 
        geom_point()
    
    
    grid.arrange(g1,g2,g3,g4,ncol=2)
    ```
    
    
    
    
    
\
\
\
\







